"use strict";(self["webpackChunkhex_vue_ec_website"]=self["webpackChunkhex_vue_ec_website"]||[]).push([[348],{8214:function(e,t,o){o.r(t),o.d(t,{default:function(){return fe}});var s=o(3396),l=o(7139),n=o(9242);const a={class:"container"},i=(0,s._)("p",{class:"h2 text-center my-4"},[(0,s._)("span",{class:"text-dark bg-secondary"},"優惠活動")],-1),d={class:"row justify-content-center"},u={class:"col-10"},p={class:"text-end mt-4"},c={class:"table mt-4 d-none d-md-table"},m=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",null,"名稱"),(0,s._)("th",null,"折扣百分比"),(0,s._)("th",null,"到期日"),(0,s._)("th",null,"是否啟用"),(0,s._)("th",null,"編輯")])],-1),h={class:"row"},r={class:"col-12 col-md-6"},_={class:"form-check form-switch"},b=["id","onUpdate:modelValue","onChange"],y=["for"],C={class:"col-12 col-md-6"},g={key:0,class:"text-primary"},f={key:1,class:"text-muted"},w={class:"btn-group"},v=["onClick"],k=["onClick"],x={class:"table mt-4 align-middle d-table d-md-none"},M=(0,s._)("th",null,"名稱",-1),D=(0,s._)("th",null,"折扣百分比",-1),$=(0,s._)("th",null,"到期日",-1),j=(0,s._)("th",null,"是否啟用",-1),z={class:"form-check form-switch"},R=["id","onUpdate:modelValue","onChange"],S=["for"],U={key:0,class:"text-primary"},V={key:1,class:"text-muted"},N=(0,s._)("th",null,"操作",-1),L={class:"btn-group"},Z=["onClick"],E=["onClick"];function H(e,t,o,H,I,O){const W=(0,s.up)("Loading"),Y=(0,s.up)("CouponModal"),K=(0,s.up)("DelModal");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(W,{"is-ready":I.isReady},null,8,["is-ready"]),(0,s._)("div",a,[i,(0,s._)("div",d,[(0,s._)("div",u,[(0,s._)("div",p,[(0,s._)("button",{class:"btn btn-success",type:"button",onClick:t[0]||(t[0]=e=>O.openCouponModal(!0))}," 建立新的優惠券 ")]),(0,s._)("table",c,[m,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(I.coupons,((t,o)=>((0,s.wg)(),(0,s.iD)("tr",{key:o},[(0,s._)("td",null,(0,l.zw)(t.title),1),(0,s._)("td",null,(0,l.zw)(t.percent)+"%",1),(0,s._)("td",null,(0,l.zw)(e.$filters.timeConvert(t.due_date)),1),(0,s._)("td",null,[(0,s._)("div",h,[(0,s._)("div",r,[(0,s._)("div",_,[(0,s.wy)((0,s._)("input",{class:"form-check-input",type:"checkbox",id:`enableSwitch${t.id}`,"onUpdate:modelValue":e=>t.is_enabled=e,"true-value":1,"false-value":0,onChange:e=>O.updateEnableStatus(t)},null,40,b),[[n.e8,t.is_enabled]]),(0,s._)("label",{class:"form-check-label",for:`enableSwitch${t.id}}`},null,8,y)])]),(0,s._)("div",C,[t.is_enabled?((0,s.wg)(),(0,s.iD)("span",g,"啟用中")):((0,s.wg)(),(0,s.iD)("span",f,"未啟用"))])])]),(0,s._)("td",null,[(0,s._)("div",w,[(0,s._)("button",{class:"btn btn-outline-success btn-sm",onClick:e=>O.openCouponModal(!1,t)}," 編輯 ",8,v),(0,s._)("button",{class:"btn btn-outline-primary btn-sm",onClick:e=>O.openDelCouponModal(t)}," 刪除 ",8,k)])])])))),128))])]),(0,s._)("table",x,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(I.coupons,((t,o)=>((0,s.wg)(),(0,s.iD)("tbody",{key:o},[(0,s._)("tr",null,[M,(0,s._)("td",null,(0,l.zw)(t.title),1)]),(0,s._)("tr",null,[D,(0,s._)("td",null,(0,l.zw)(t.percent)+"%",1)]),(0,s._)("tr",null,[$,(0,s._)("td",null,(0,l.zw)(e.$filters.timeConvert(t.due_date)),1)]),(0,s._)("tr",null,[j,(0,s._)("td",null,[(0,s._)("div",z,[(0,s.wy)((0,s._)("input",{class:"form-check-input",type:"checkbox",id:`enableSwitch${t.id}`,"onUpdate:modelValue":e=>t.is_enabled=e,"true-value":1,"false-value":0,onChange:e=>O.updateEnableStatus(t)},null,40,R),[[n.e8,t.is_enabled]]),(0,s._)("label",{class:"form-check-label",for:`enableSwitch${t.id}}`},null,8,S),t.is_enabled?((0,s.wg)(),(0,s.iD)("span",U,"啟用中")):((0,s.wg)(),(0,s.iD)("span",V,"未啟用"))])])]),(0,s._)("tr",null,[N,(0,s._)("td",null,[(0,s._)("div",L,[(0,s._)("button",{class:"btn btn-outline-success btn-sm",onClick:e=>O.openCouponModal(!1,t)}," 編輯 ",8,Z),(0,s._)("button",{class:"btn btn-outline-primary btn-sm",onClick:e=>O.openDelCouponModal(t)}," 刪除 ",8,E)])])])])))),128))])])])]),(0,s.Wm)(Y,{coupon:I.tempCoupon,"is-new":I.isNew,ref:"couponModal",onUpdateCoupon:O.updateCoupon},null,8,["coupon","is-new","onUpdateCoupon"]),(0,s.Wm)(K,{item:I.tempCoupon,ref:"delModal",onDelItem:O.delCoupon},null,8,["item","onDelItem"])],64)}const I={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},O={class:"modal-dialog",role:"document"},W={class:"modal-content"},Y={class:"modal-header bg-success text-white"},K={class:"modal-title",id:"exampleModalLabel"},T={key:0},B={key:1},P=(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},A={class:"mb-3"},F=(0,s._)("label",{for:"title"},"標題",-1),G={class:"mb-3"},J=(0,s._)("label",{for:"coupon_code"},"優惠碼",-1),Q={class:"mb-3"},X=(0,s._)("label",{for:"due_date"},"到期日",-1),ee={class:"mb-3"},te=(0,s._)("label",{for:"price"},"折扣百分比",-1),oe={class:"mb-3"},se={class:"form-check form-switch"},le=["id"],ne=["for"],ae={key:0,class:"text-primary"},ie={key:1,class:"text-muted"},de={class:"modal-footer"},ue=(0,s._)("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"}," 取消 ",-1);function pe(e,t,o,a,i,d){return(0,s.wg)(),(0,s.iD)("div",I,[(0,s._)("div",O,[(0,s._)("div",W,[(0,s._)("div",Y,[(0,s._)("h5",K,[o.isNew?((0,s.wg)(),(0,s.iD)("span",T,"新增優惠卷")):((0,s.wg)(),(0,s.iD)("span",B,"編輯優惠卷"))]),P]),(0,s._)("div",q,[(0,s._)("div",A,[F,(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=e=>i.tempCoupon.title=e),placeholder:"請輸入標題"},null,512),[[n.nr,i.tempCoupon.title]])]),(0,s._)("div",G,[J,(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=e=>i.tempCoupon.code=e),placeholder:"請輸入優惠碼"},null,512),[[n.nr,i.tempCoupon.code]])]),(0,s._)("div",Q,[X,(0,s.wy)((0,s._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=e=>i.due_date=e)},null,512),[[n.nr,i.due_date]])]),(0,s._)("div",ee,[te,(0,s.wy)((0,s._)("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[3]||(t[3]=e=>i.tempCoupon.percent=e),placeholder:"請輸入折扣百分比"},null,512),[[n.nr,i.tempCoupon.percent,void 0,{number:!0}]])]),(0,s._)("div",oe,[(0,s._)("div",se,[(0,s.wy)((0,s._)("input",{class:"form-check-input",type:"checkbox",id:`enableSwitch${i.tempCoupon.id}`,"onUpdate:modelValue":t[4]||(t[4]=e=>i.tempCoupon.is_enabled=e),"true-value":1,"false-value":0},null,8,le),[[n.e8,i.tempCoupon.is_enabled]]),(0,s._)("label",{class:"form-check-label",for:`enableSwitch${i.tempCoupon.id}}`},null,8,ne),i.tempCoupon.is_enabled?((0,s.wg)(),(0,s.iD)("span",ae," 啟用中 ")):((0,s.wg)(),(0,s.iD)("span",ie,"未啟用"))])])]),(0,s._)("div",de,[ue,(0,s._)("button",{type:"button",class:"btn btn-outline-primary",onClick:t[5]||(t[5]=t=>e.$emit("update-coupon",i.tempCoupon))},(0,l.zw)(o.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}var ce=o(1339),me={props:{coupon:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!1}},data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{coupon(){this.tempCoupon=this.coupon;const e=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");[this.due_date]=e},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[ce.Z]},he=o(89);const re=(0,he.Z)(me,[["render",pe]]);var _e=re,be=o(3167),ye=o(5517),Ce={props:{config:Object},data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isLoading:!1,isReady:!0,isNew:!1}},components:{CouponModal:_e,DelModal:be.Z,Loading:ye.Z},inject:["emitter"],methods:{getCoupons(){this.isReady=!1;const e="https://vue3-course-api.hexschool.io/v2/api/hyxfish27/admin/coupons";this.$http.get(e,this.tempProduct).then((e=>{this.coupons=e.data.coupons,this.isReady=!0})).catch((e=>{this.isReady=!0,this.emitter.emit("push-message",{style:"danger",title:e.response.data.message,emoji:"emoji-dizzy"})}))},updateCoupon(e){this.isReady=!1;let t="https://vue3-course-api.hexschool.io/v2/api/hyxfish27/admin/coupon",o="post",s=e;this.isNew||(t=`https://vue3-course-api.hexschool.io/v2/api/hyxfish27/admin/coupon/${this.tempCoupon.id}`,o="put",s=this.tempCoupon),this.$http[o](t,{data:s}).then((e=>{this.isReady=!0,this.emitter.emit("push-message",{style:"success",title:e.data.message,emoji:"emoji-laughing"}),this.getCoupons(),this.$refs.couponModal.hideModal()})).catch((e=>{this.isReady=!0,this.emitter.emit("push-message",{style:"danger",title:e.response.data.message,emoji:"emoji-dizzy"})}))},delCoupon(){const e=`https://vue3-course-api.hexschool.io/v2/api/hyxfish27/admin/coupon/${this.tempCoupon.id}`;this.isReady=!1,this.$http.delete(e).then((e=>{this.isReady=!0,this.emitter.emit("push-message",{style:"success",title:e.data.message,emoji:"emoji-laughing"}),this.$refs.delModal.hideModal(),this.getCoupons()})).catch((e=>{this.isReady=!0,this.emitter.emit("push-message",{style:"danger",title:e.response.data.message,emoji:"emoji-dizzy"})}))},updateEnableStatus(e){this.isReady=!1;const t=`https://vue3-course-api.hexschool.io/v2/api/hyxfish27/admin/coupon/${e.id}`;this.$http.put(t,{data:e}).then((e=>{this.emitter.emit("push-message",{style:"success",title:e.data.message,emoji:"emoji-laughing"}),this.getCoupons(),this.isReady=!0})).catch((e=>{this.emitter.emit("push-message",{style:"danger",title:e.response.data.message,emoji:"emoji-dizzy"}),this.isReady=!0})),this.$refs.couponModal.hideModal()},openCouponModal(e,t){this.isNew=e,this.isNew?this.tempCoupon={due_date:(new Date).getTime()/1e3}:this.tempCoupon={...t},this.$refs.couponModal.openModal()},openDelCouponModal(e){this.tempCoupon={...e},this.$refs.delModal.openModal()}},created(){this.getCoupons()}};const ge=(0,he.Z)(Ce,[["render",H]]);var fe=ge}}]);
//# sourceMappingURL=348.43550152.js.map